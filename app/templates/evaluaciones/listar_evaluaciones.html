<!doctype html>
<html lang="es">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
  <title>Listar Evaluaciones</title>
</head>

<body>
  <h1>Evaluaciones</h1>


  <ul class="evaluations-list">
    {% for ev in evaluaciones %}
    <li>
      <div class="group-card eval-card" data-evaluacion-id="{{ ev.id }}" tabindex="0" role="button">
        <a href="{{ url_for('evaluacion_bp.detalle_evaluacion', id=ev.id) }}" class="open-eval">{{ ev.id }} - {{
          ev.titulo }}</a>
      </div>
    </li>
    {% else %}
    <li>No hay evaluaciones.</li>
    {% endfor %}
  </ul>



  <!-- Spacer to prevent content from being hidden behind the fixed button -->
  <div style="height: 100px;"></div>

  <!-- Button to open modal -->
  <button id="btn-open-modal"
    style="position:fixed; bottom:0; left:0; width:100%; padding:1rem; font-size:1.1rem; margin:0; border-radius:0; z-index:100; box-shadow:0 -2px 10px rgba(0,0,0,0.1);">Crear
    evaluacion</button>

  <!-- Modal -->
  <div id="modal-create" class="modal-backdrop" style="display:none;">
    <div class="modal modal--small">
      <h2 style="margin-top:0;">Nueva Evaluación</h2>
      <form method="post" action="{{ url_for('evaluacion_bp.crear_evaluacion') }}">
        <label for="titulo">Título de la evaluación:</label>
        <input type="text" id="titulo" name="titulo" required autocomplete="off" style="margin-bottom:1.5rem;">

        <div style="display:flex; gap:1rem; justify-content:flex-end;">
          <button type="button" id="btn-close-modal" class="btn secondary">Cancelar</button>
          <button type="submit">Crear</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    (function () {
      // Modal logic
      const modal = document.getElementById('modal-create');
      const btnOpen = document.getElementById('btn-open-modal');
      const btnClose = document.getElementById('btn-close-modal');

      if (btnOpen && modal) {
        btnOpen.addEventListener('click', function () {
          modal.style.display = 'flex';
          setTimeout(() => {
            const input = modal.querySelector('input[name="titulo"]');
            if (input) input.focus();
          }, 50);
        });
      }

      if (btnClose && modal) {
        btnClose.addEventListener('click', function () {
          modal.style.display = 'none';
        });
      }

      if (modal) {
        modal.addEventListener('click', function (e) {
          if (e.target === modal) {
            modal.style.display = 'none';
          }
        });
        document.addEventListener('keydown', function (e) {
          if (e.key === 'Escape' && modal.style.display === 'flex') {
            modal.style.display = 'none';
          }
        });
      }

      // make evaluation cards clickable and keyboard-activatable
      document.addEventListener('click', function (e) {
        const card = e.target.closest && e.target.closest('.eval-card');
        if (!card) return;
        if (e.target.closest && e.target.closest('.open-eval')) return;
        const link = card.querySelector('.open-eval');
        if (link) { e.preventDefault(); window.location = link.href; }
      });
      document.addEventListener('keydown', function (e) {
        if (e.key !== 'Enter' && e.key !== ' ') return;
        const el = document.activeElement;
        if (!el || !el.classList.contains('eval-card')) return;
        const link = el.querySelector('.open-eval');
        if (link) { e.preventDefault(); window.location = link.href; }
      });
    })();
  </script>
</body>

</html>